<!doctype html>
<html lang="en">
<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="apple-touch-icon" sizes="76x76" href="assets/images/olade-logo-blue.png">
  <link rel="icon" type="image/png" href="assets/images/olade-logo-blue.png">
  <!--    font-awesome-->
  <link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

  <link rel="stylesheet" href="assets/css/bootstrap.css">
  <link rel="stylesheet" href="assets/css/bootstrap.min.css">

  <link rel="stylesheet" href="assets/css/main.css">
  <link href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300;0,400;0,500;0,600;0,700;0,900;1,300;1,600;1,800&display=swap" rel="stylesheet">
  <title>Create Invoice</title>
</head>
<body style="  background: #e8edf5;  width: 100%; height: 100%;">

<div class="wrapper" >

  <div class="top_navbar">
    <div class="logo">
      <a href="#"><img src="assets/images/Olade_logo_white.png" width="75px"></a>
    </div>
    <div class="top_menu">
      <div class="home_link page-header">
        <!--                <a href="#">-->
        <!--                    <span class="icon"><i class="fas fa-home"></i></span>-->
        <!--                    <span>Home</span>-->
        <!--                </a>-->
        Manage Financials
      </div>
      <div class="right_info">
        <!--                <div class="icon_wrap">-->
        <!--                    <div class="icon">-->
        <!--                        <i class="fas fa-bell"></i>-->
        <!--                    </div>-->
        <!--                </div>-->
        <!--                <div class="icon_wrap">-->
        <!--                    <div class="icon">-->
        <!--                        <i class="fas fa-cog"></i>-->
        <!--                    </div>-->
        <!--                </div>-->
        <div class="dropdown  pic">
          <div class="profile-pic dropdown-toggle" href="#" role="button" id="dropdownMenuLink3" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <img src="assets/images/user-profile.png" class="img-rounded" style="width: 35px; height: 35px;border-radius: 50px"/>
            <span class="pl-2" style="font-size: 14px" id="profilename"></span>
          </div>

          <div class="dropdown-menu " aria-labelledby="dropdownMenuLink">
            <a class="dropdown-item text-black-50" href="#" style="font-size: 14px"><i class="fas fa-power-off mr-2"></i>Logout</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="main_body " >

    <div class="sidebar_menu ">
      <div class="inner__sidebar_menu">

        <ul >
          <li>
            <a href="#">
		              <span class="icon">
		              	<i class="fas fa-border-all"></i></span>
              <span class="list">Summary Dashboard</span>
            </a>
          </li>
          <li>
            <a href="user-management.html" class="">
              <span class="icon"><i class="fas fa-address-book"></i></span>
              <span class="list">User Management</span>
            </a>
          </li>
          <li>
            <a href="lead-report.html">
              <span class="icon"><i class="fas fa-filter"></i></span>
              <span class="list">Lead Management</span>
            </a>
          </li>
          <li>
            <a href="progress-report.html">
              <span class="icon"><i class="fas fa-spinner"></i></span>
              <span class="list">Progress Reports</span>
            </a>
          </li>
          <li>
            <a href="#">
              <span class="icon"><i class="fas fa-chart-pie"></i></span>
              <span class="list">Course Report</span>
            </a>
          </li>
          <li>
            <a href="#">
              <span class="icon"><i class="fas fa-tasks"></i></span>
              <span class="list">Assignment</span>
            </a>
          </li>
          <li>
            <a href="#">
              <span class="icon"><i class="fas fa-file-alt"></i></span>
              <span class="list">Training Programs</span>
            </a>
          </li>
          <li>
            <a href="#">
              <span class="icon"><i class="fas fa-certificate"></i></span>
              <span class="list">Certificates</span>
            </a>
          </li>
          <li>
            <a href="manage-financials.html" class="active">
              <span class="icon"><i class="fas fa-credit-card"></i></span>
              <span class="list">Manage Financial</span>
            </a>
          </li>
          <li>
            <a href="#">
              <span class="icon"><i class="fas fa-globe"></i></span>
              <span class="list">Community</span>
            </a>
          </li>
          <li>
            <a href="settings.html">
              <span class="icon"><i class="fas fa-cog"></i></span>
              <span class="list">Settings</span>
            </a>
          </li>
          <!--                    <li>-->
          <!--                        <a href="#">-->
          <!--                            <span class="icon"><i class="fas fa-sign-out-alt"></i></span>-->
          <!--                            <span class="list">Logout</span>-->
          <!--                        </a>-->
          <!--                    </li>-->
        </ul>

        <!--                <div class="hamburger">-->
        <!--                    <div class="inner_hamburger">-->
        <!--			            <span class="arrow">-->
        <!--			                <i class="fas fa-long-arrow-alt-left"></i>-->
        <!--			                <i class="fas fa-long-arrow-alt-right"></i>-->
        <!--			            </span>-->
        <!--                    </div>-->
        <!--                </div>-->

      </div>
    </div>

    <div class="sub-container" >
      <div class="card">
        <div class="pt-3 pl-3 pr-3">


          <ul class="nav nav-tabs " role="tablist">
            <li class="nav-item ">
              <a class="nav-link " href="manage-financials.html">ADD PAYMENT</a>
            </li>
            <li class="nav-item">
              <a class="nav-link"  href="reciept.html">RECEIPTS</a>
            </li>
            <li class="nav-item">
              <a class="nav-link"  href="outstanding-balance.html">OUTSTANDING BALANCES</a>
            </li>
            <li class="nav-item">
              <a class="nav-link"  href="invoices.html">INVOICES</a>
            </li>
            <li class="nav-item  active">
              <a class="nav-link"  href="corporate-invoices.html">CREATE INVOICE</a>
            </li>
            <li class="nav-item">
              <a class="nav-link"  href="create-coupon.html">CREATE COUPON</a>
            </li>
            <li class="nav-item">
              <a class="nav-link"  href="financial-report.html">FINANCIAL REPORT</a>
            </li>
            <!--            <li class="nav-item">-->
            <!--              <a class="nav-link" data-toggle="tab" href="#on-boarding">OTHERS</a>-->
            <!--            </li>-->
          </ul>

        </div>
      </div>


      <div class="card mt-3 ">
        <div class="card-body">
          <div class="mt-1 mb-5">
            <h5>
              Create Invoice
            </h5>
          </div>
          <div class="container">
          <div class="row">
            <div class="col-sm-3 col-lg-3">
              <label class="form-label">Company Name<font color="red">*</font></label>
              <input type="text" class="form-control" id="cname"
                     placeholder="Enter company name">
            </div>
            <div class="col-sm-3 col-lg-3">
              <label class="form-label">Company Address<font color="red">*</font></label>
              <input type="text" class="form-control" id="caddr"
                     placeholder="Enter Address">
            </div>
            <div class="col-sm-3 col-lg-3">
                <label class="form-label">Company Email Address<font color="red">*</font></label>
                <input type="text" class="form-control" id="cemail"
                       placeholder="Enter email">
            </div>
            <div class="col-sm-3 col-lg-3 mb-3">
              <label class="form-label">Company Phone<font color="red">*</font></label>
              <input type="text" class="form-control" id="cpno"
                     placeholder="Enter phone number">
            </div>
          </div>
          </div>
          <div class="container">

            <div class="row">
              <div class="col-md-12">
                <br>
                <button class="btn btn-pry float-end add-row mb-3"><i class="fa fa-plus"></i>&nbsp;&nbsp; Add new line item</button>
              </div>
            </div>

            <div class="row">
              <div class="col-md-12">
                <table class="table table-bordered" id="editableTable">
                  <thead>
                  <tr>
                    <th>Course (Item Description)</th>
                    <th>Price (CAD$)</th>
                    <th>Quantity</th>
                    <th>Total (CAD$)</th>
                    <th>Edit</th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr data-id="1">
                    <td data-field="name">Business Analysis</td>
                    <td data-field="price">CAD$ 1000</td>
                    <td data-field="quantity">1</td>
                    <td data-field="sex">CAD$ 1000</td>
                    <td>
                      <a class="button button-small edit" title="Edit">
                        <i class="fa fa-edit"></i>
                      </a>

                      <a class="button button-small edit" title="Delete">
                        <i class="fa fa-trash"></i>
                      </a>
                    </td>
                  </tr>
                  <tr data-id="2">
                    <td data-field="name">Project Management</td>
                    <td data-field="price">CAD$ 1000</td>
                    <td data-field="quantity">2</td>
                    <td data-field="sex">CAD$ 2000</td>
                    <td>
                      <a class="button button-small edit" title="Edit">
                        <i class="fa fa-edit"></i>
                      </a> <a class="button button-small edit" title="Delete">
                      <i class="fa fa-trash"></i>
                    </a>
                    </td>
                  </tr>
<!--                  <tr data-id="3">-->
<!--                    <td data-field="name">Halyna Nadia</td>-->
<!--                    <td data-field="birthday">May 25, 2015</td>-->
<!--                    <td data-field="age">22</td>-->
<!--                    <td data-field="sex">Female</td>-->
<!--                    <td>-->
<!--                      <a class="button button-small edit" title="Edit">-->
<!--                        <i class="fa fa-pencil"></i>-->
<!--                      </a> <a class="button button-small" title="Delete">-->
<!--                      <i class="fa fa-trash"></i>-->
<!--                    </a>-->
<!--                    </td>-->
<!--                  </tr>-->

                  </tbody>
                </table>
                <table class="table-bordered float-end mb-5">
                  <tbody>
                <tr>
                  <td colspan="3"></td>
                  <td><b>SUB TOTAL</b></td>
                  <td><b>CAD$ <span id="subtotal"></span></b></td>
                </tr>
                <tr>
                  <td colspan="3"></td>
                  <td><b>HST 13%</b></td>
                  <td><b>CAD$ <span id="tax"></span></b></td>
                </tr>
                <!--                <tr>-->
                <!--                    <td colspan="3"></td>-->
                <!--                    <td><b>DISCOUNT 3%</b></td>-->
                <!--                    <td><b>16000</b></td>-->
                <!--                </tr>-->
                <tr style="color: #0099D5;">
                  <td colspan="3"></td>
                  <td><b>GRAND TOTAL (CAD$)</b></td>
                  <td><b>CAD$ <span id="total"></span></b></td>
                </tr>
                  </tbody>
                </table>

              </div>
              <div class="col-md-11"></div>
              <div class="col-md-1"><button type="button" class="btn btn-pry" onclick="createInvoice();">SAVE</button></div>
            </div>
          </div>
        </div>
      </div>



    </div>
  </div>
</div>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

<script src="https://kit.fontawesome.com/b99e675b6e.js"></script>

<script>
  var url = "http://localhost:8080";
  //var wordpressUrl = "http://localhost:8099";
  //var url = "https://proinsight-reconservice.herokuapp.com";
  var wordpressUrl = "https://proinsight-lmsservice.herokuapp.com";
  
  //ON-READY FUNCTION
  (function() {
    if(sessionStorage.getItem("lg") != 1){
      location.href = "login.html";
    }
    if(sessionStorage.getItem("user") != null){
      var user = JSON.parse(sessionStorage.getItem("user"));
      console.log("Check "+user);
      //console.log("yes"+fname);
      document.getElementById("profilename").innerHTML = user.email;
      sender = user.email;
      //document.getElementById("oladeEmail").innerHTML = user.email;
    }

    //Set Values
    document.getElementById("subtotal").innerHTML = "0.00";
    document.getElementById("tax").innerHTML = "0.00";
    document.getElementById("total").innerHTML = "0.00";

    $(".hamburger").click(function(){
      $(".wrapper").toggleClass("active")
    })
  })();

  //Create Invoice
  function createInvoice(){
    var items = [];
    var count = $('#editableTable tr').length;
    console.log("Table Length "+count);
    for(var i = 1; i < count; i++){
      var item = {
        name : document.getElementById("editableTable").rows[i].cells[0].innerHTML,
        quantity : document.getElementById("editableTable").rows[i].cells[1].text,
        unitPrice : document.getElementById("editableTable").rows[i].cells[2].innerHTML
      }

      items.push(item);
      
    }

    var invoice = {
        name : document.getElementById("cname").value,
        address : document.getElementById("caddr").value,
        email : document.getElementById("cemail").value,
        pno : document.getElementById("cpno").value
      }

    var payload = JSON.stringify({
        'invoice' : invoice,
        'items' : items
      });

    console.log("Data "+payload);

    //Calling the API -
    $.ajax({
      type: "POST",
      beforeSend: function(request) {
        request.setRequestHeader("Access-Control-Allow-Headers", "X-Requested-With, content-type");
      },
      url: url + "/payments/shareinvoice",
      contentType: "application/json",
      dataType: 'json',
      data: JSON.stringify({
        documentID : rid,
        to : document.getElementById("to").value,
        subject : document.getElementById("subject").value,
        message : document.getElementById("message").value,
        senderID : sender
      }),
      success: function(result){
        swal({
          title: result['status'],
          text: result['message'],
          icon: "success",
        })
                .then(() => {
                  location.reload();
                });
      },
      error: function(result){
        var json = $.parseJSON(result.responseText);
        swal({
          title: json.status,
          text: json.message,
          icon: "error",
        });
      }
    })

  }

  //Download Invoice
  function download1(){
    //Calling the API -
    $.ajax({
      type: "GET",
      beforeSend: function(request) {
        request.setRequestHeader("Access-Control-Allow-Headers", "X-Requested-With, content-type");
      },
      url: url + "/payments/downloadinvoice/" + rid,
      contentType: "application/json",
      dataType: 'json',
      success: function(result){
        swal({
          title: result['status'],
          text: result['message'],
          icon: "success",
        })
                .then(() => {
                  location.reload();
                });
      },
      error: function(result){
        var json = $.parseJSON(result.responseText);
        swal({
          title: json.status,
          text: json.message,
          icon: "error",
        });
      }
    })

  }

  //Function to search table
  function search(){
    var input = document.getElementById("q");
    var filter = input.value.toUpperCase();
    jsonData = [];
    for(var i = 0; i < invoices.length; i++){
      var date = new Date(invoices[i].createdTime);
      var createdDate = "" + months[date.getMonth()] + " " + date.getDate() + ", " + date.getFullYear();
      if(invoices[i].candidateName.toUpperCase().indexOf(filter) > -1 || invoices[i].program.toUpperCase().indexOf(filter) > -1 || invoices[i].name.toUpperCase().indexOf(filter) > -1
              || createdDate.toUpperCase().indexOf(filter) > -1){
        jsonData.push(invoices[i]);
      }
    }
    changePage(1);
  }

  function prevPage(){
    if (current_page > 1) {
      current_page--;
      changePage(current_page);
    }
  }
  function nextPage(){
    if (current_page < numPages()) {
      current_page++;
      changePage(current_page);
    }
  }
  function changePage(page){
    var btn_next = document.getElementById("btn_next");
    var btn_prev = document.getElementById("btn_prev");
    var listing_table = document.getElementById("fi");
    var page_span = document.getElementById("page");

    // Validate page
    if (page < 1) page = 1;
    if (page > numPages()) page = numPages();

    listing_table.innerHTML = "";

    listing_table.innerHTML += '<thead><tr><th>Student Name</th><th>Program</th><th>File</th><th>Date</th><th>Actions</th></tr></thead>';
    listing_table.innerHTML += '<tbody>';
    var total = page * records_per_page;
    if(jsonData.length < (page * records_per_page)){
      total = jsonData.length;
    }
    for (let i = (page-1) * records_per_page; i < total; i++) {
      let j = i;
      //console.log("mexid "+exams[i].id);
      var date = new Date(jsonData[i].createdTime);
      var createdDate = "" + months[date.getMonth()] + " " + date.getDate() + ", " + date.getFullYear();
      var oneRecord = '<tr><td>' + jsonData[i].candidateName + '</td><td>' + jsonData[i].program + '</td><td>' + jsonData[i].name + '</td><td>' + createdDate + '</td><td class="options-ham-menu"> <div class="actions dropdown"> \
                                <span class="actions  dropdown-toggle" href="#"  id="action-dropDown2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" onclick="kclick(\''+j+'\');">...</span> \
                                <div class="action dropdown-menu" aria-labelledby="action-dropDown2"><a class="dropdown-item"  data-toggle="modal" data-target="#exampleModal" style="cursor: pointer">Send Invoice</a> \
                                <a class="dropdown-item" onclick="download1(\''+jsonData[i].id+'\', \'3\');">Download Invoice</a></div></div></td></tr>';
      listing_table.innerHTML += oneRecord;
    }
    listing_table.innerHTML += '</tbody>';
    page_span.innerHTML = page;

    if (page == 1) {
      btn_prev.style.visibility = "hidden";
    } else {
      btn_prev.style.visibility = "visible";
    }

    if (page == numPages()) {
      btn_next.style.visibility = "hidden";
    } else {
      btn_next.style.visibility = "visible";
    }
  }

  function numPages(){
    return Math.ceil(jsonData.length / records_per_page);
  }

  //Function to handle the transition of selected invoice
  function kclick(x){
    //console.log("My "+jsonData[x]);
    var aInvoice = jsonData[x];
    console.log("Cand "+aInvoice.candidateEmail);

    document.getElementById("to").value = aInvoice.candidateEmail;
    document.getElementById("to").text = aInvoice.candidateEmail;
    document.getElementById("subject").value = "Olade Consulting - Payment Invoice";
    document.getElementById("subject").text = "Olade Consulting - Payment Invoice";
    rid = aInvoice.id;
  }
</script>

<!--Create Invoice-->
<script>
  (function($, window, document, undefined) {
    var pluginName = "editable",
            defaults = {
              keyboard: true,
              dblclick: true,
              button: true,
              buttonSelector: ".edit",
              maintainWidth: true,
              dropdowns: {},
              edit: function() {},
              save: function() {},
              cancel: function() {}
            };

    function editable(element, options) {
      this.element = element;
      this.options = $.extend({}, defaults, options);

      this._defaults = defaults;
      this._name = pluginName;

      this.init();
    }

    editable.prototype = {
      init: function() {
        this.editing = false;

        if (this.options.dblclick) {
          $(this.element)
                  .css('cursor', 'pointer')
                  .bind('dblclick', this.toggle.bind(this));
        }

        if (this.options.button) {
          $(this.options.buttonSelector, this.element)
                  .bind('click', this.toggle.bind(this));
        }
      },

      toggle: function(e) {
        e.preventDefault();

        this.editing = !this.editing;

        if (this.editing) {
          this.edit();
        } else {
          this.save();
        }
      },

      edit: function() {
        var instance = this,
                values = {};

        $('td[data-field]', this.element).each(function() {
          var input,
                  field = $(this).data('field'),
                  value = $(this).text(),
                  width = $(this).width();

          values[field] = value;

          $(this).empty();

          if (instance.options.maintainWidth) {
            $(this).width(width);
          }

          if (field in instance.options.dropdowns) {
            input = $('<select></select>');

            for (var i = 0; i < instance.options.dropdowns[field].length; i++) {
              $('<option></option>')
                      .text(instance.options.dropdowns[field][i])
                      .appendTo(input);
            };

            input.val(value)
                    .data('old-value', value)
                    .dblclick(instance._captureEvent);
          } else {
            input = $('<input type="text" />')
                    .val(value)
                    .data('old-value', value)
                    .dblclick(instance._captureEvent);
          }

          input.appendTo(this);

          if (instance.options.keyboard) {
            input.keydown(instance._captureKey.bind(instance));
          }
        });

        this.options.edit.bind(this.element)(values);
      },

      save: function() {
        var instance = this,
                values = {};

        $('td[data-field]', this.element).each(function() {
          var value = $(':input', this).val();

          values[$(this).data('field')] = value;

          $(this).empty()
                  .text(value);
        });

        this.options.save.bind(this.element)(values);
      },

      cancel: function() {
        var instance = this,
                values = {};

        $('td[data-field]', this.element).each(function() {
          var value = $(':input', this).data('old-value');

          values[$(this).data('field')] = value;

          $(this).empty()
                  .text(value);
        });

        this.options.cancel.bind(this.element)(values);
      },

      _captureEvent: function(e) {
        e.stopPropagation();
      },

      _captureKey: function(e) {
        if (e.which === 13) {
          this.editing = false;
          this.save();
        } else if (e.which === 27) {
          this.editing = false;
          this.cancel();
        }
      }
    };

    $.fn[pluginName] = function(options) {
      return this.each(function() {
        if (!$.data(this, "plugin_" + pluginName)) {
          $.data(this, "plugin_" + pluginName,
                  new editable(this, options));
        }
      });
    };

  })(jQuery, window, document);

  editTable();

  //custome editable starts
  function editTable(){

    $(function() {
      var pickers = {};

      $('table tr').editable({
        dropdowns: {
          sex: ['Male', 'Female']
        },
        edit: function(values) {
          $(".edit i", this)
                  .removeClass('fa-pencil')
                  .addClass('fa-save')
                  .attr('title', 'Save');

          pickers[this] = new Pikaday({
            field: $("td[data-field=birthday] input", this)[0],
            format: 'MMM D, YYYY'
          });
        },
        save: function(values) {
          $(".edit i", this)
                  .removeClass('fa-save')
                  .addClass('fa-pencil')
                  .attr('title', 'Edit');

          if (this in pickers) {
            pickers[this].destroy();
            delete pickers[this];
          }
        },
        cancel: function(values) {
          $(".edit i", this)
                  .removeClass('fa-save')
                  .addClass('fa-pencil')
                  .attr('title', 'Edit');

          if (this in pickers) {
            pickers[this].destroy();
            delete pickers[this];
          }
        }
      });
    });

  }

  $(".add-row").click(function(){
    $("#editableTable").find("tbody tr:first").before("<tr><td data-field='name'></td><td data-field='name'></td><td data-field='name'></td><td data-field='name'></td><td><a class='button button-small edit' title='Edit'><i class='fa fa-pencil'></i></a> <a class='button button-small' title='Delete'><i class='fa fa-trash'></i></a></td></tr>");
    editTable();
    setTimeout(function(){
      $("#editableTable").find("tbody tr:first td:last a[title='Edit']").click();
    }, 200);

    setTimeout(function(){
      $("#editableTable").find("tbody tr:first td:first input[type='text']").focus();
    }, 300);

    $("#editableTable").find("a[title='Delete']").unbind('click').click(function(e){
      $(this).closest("tr").remove();
    });

  });

  function myFunction() {

  }

  $("#editableTable").find("a[title='Delete']").click(function(e){
    var x;
    if (confirm("Are you sure you want to delete entire row?") == true) {
      $(this).closest("tr").remove();
    } else {

    }
  });
</script>

</body>
</html>
<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="apple-touch-icon" sizes="76x76" href="assets/images/olade-logo-blue.png">
    <link rel="icon" type="image/png" href="assets/images/olade-logo-blue.png">
    <!--    font-awesome-->
    <link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">

    <link rel="stylesheet" href="assets/css/main.css">
    <link href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300;0,400;0,500;0,600;0,700;0,900;1,300;1,600;1,800&display=swap" rel="stylesheet">
    <title>Candidate Enrollment</title>
</head>
<body>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-4">
            <div class="login-bg text-white">
                <div class="pt-lg-5">
                    <p class="">Find Bright, Diverse And
                        <br>
                        Innovative Tech Talent
                    </p>
                </div>
            </div>

        </div>
        <div class="col-md-8 m-auto">
            <div class="container p-5">
                <div class="float-end">
                    <a href="" id="logo-container"><img src="assets/images/olade-logo-blue.png" width="70" alt=""></a>
                </div>
            </div>

            <div class="login-form ">
                    <h1>Student Enrollment</h1>
                    <form id="withPay" class=" mt-4">
                        <div class="mb-4">
                            <h5>Billing Details</h5>
                        </div>
                        <div class="mb-4 row pr-5">
                            <div class="col-lg-6">
                                <label class="form-label">First Name<font color="red">*</font></label>
                                <input type="text" class="form-control" id="wfname"
                                       placeholder="">
                            </div>
                            <div class="col-lg-6">
                                <label class="form-label">Last Name<font color="red">*</font></label>
                                <input type="text" class="form-control" id="wlname"
                                       placeholder="">
                            </div>
                        </div>
                        <div class="mb-4 row pr-5">
                            <div class="col-lg-12">
                                <label class="form-label">Email Address<font color="red">*</font></label>
                                <input type="text" class="form-control" id="wemail"
                                       placeholder="" disabled>
                            </div>
                            <div class="col-lg-6">
                                <label class="form-label">Phone Number<font color="red">*</font></label>
                                <input type="text" class="form-control" id="wpno"
                                       placeholder="">
                            </div>
                            <div class="col-lg-6">
                                <label class="form-label">Country / Region <font color="red">*</font></label>
                                <select class="form-control" id="wcountry" onchange="changeCountry1()">

                                </select>
                            </div>

                        </div>
                        <div class="mb-4 row pr-5">
                            <div class="col-lg-6">
                                <label class="form-label">Full street address <font color="red">*</font></label>
                                <input class="form-control" placeholder="Full street address" id="waddr" onkeyup="pressKey(event);" type="text" pattern="[A-Za-z0-9, ]+" >
                            </div>
                            <div class="col-lg-6">
                                <label class="form-label">Apartment, Suite, Unit </label>
                                <input class="form-control" placeholder="Apartment, Suite, Unit (optional)" id="wapartment" onkeyup="pressKey(event);" type="text">
                            </div>

                        </div>
                        <div class="mb-4 row pr-5">
                            <div class="col-lg-6">
                                <label class="form-label">Town / city <font color="red">*</font></label>
                                <input class="form-control" placeholder="Town / city" id="wtown" onkeyup="pressKey(event);" type="text" pattern="[A-Za-z- ]+" >
                            </div>
                            <div id="whidprovince" class="col-lg-6">
                                <label class="form-label">Province <font color="red">*</font></label>
                                <select class="form-control" id="wprovince1" onchange="changeProvince1()">
                                    <option value="" selected>-Select Province-</option>

                                </select>
                            </div>
                            <div id="whidstate" class="col-lg-6">
                                <label class="form-label">State <font color="red">*</font></label>
                                <input class="form-control" placeholder="State" id="wprovince" onkeyup="pressKey(event);" type="text" pattern="[A-Za-z- ]+" >
                            </div>

                        </div>
                        <div class="mb-4 pt-3">
                            <h5>User Login Details</h5>
                        </div>

                        <div class="mb-4 pr-5 row">
                            <div class="col-lg-6">
                                <label class="form-label">Display Name</label>
                                <input type="text" class="form-control" id="wdname"
                                       placeholder="">
                            </div>
                            <div class="col-lg-6">
                                <label class="form-label">Username<font color="red">*</font></label>
                                <input type="text" class="form-control" id="wusername"
                                       placeholder="">
                            </div>
                        </div>
                        <div class="mb-4 pr-5 row">
                            <div class="col-lg-6">
                                <label class="form-label">Password<font color="red">*</font></label>
                                <input type="password" class="form-control" id="wpassword"
                                       placeholder="">
                            </div>
                            <div class="col-lg-6">
                                <label class="form-label">Confirm Password<font color="red">*</font></label>
                                <input type="password" class="form-control" id="wcpassword"
                                       placeholder="">
                            </div>
                        </div>
                        <div class="mb-2 pt-4">
                            <h5>Payment Details</h5><br>
                            <h6 id="totalFee"></h6>
                        </div>


                        <div class="row" style="width: 75%">
                            <div class="col-lg-6" style="font-weight: 600">
                                <p>Payment Type<font color="red">* <span id="minInfo"></span></font></p>
                            </div>
                            <div class="col-lg-6" style="font-weight: 600">
                                <select class="form-control" id="paymentType" style="font-size: 14px" onchange="showAmount();">
                                    <option value="1" selected="selected">Full Payment</option>
                                    <option value="2">Installmental Payment</option>
                                </select>
                                <!--p id="dTotalAmount"></p-->
                            </div>

                            <!--div class="col-lg-6" style="font-weight: 600">
                               <p> Product</p>
                            </div>
                            <div class="col-lg-6" style="font-weight: 600">
                                <p>Subtotal</p>
                            </div-->

                            <hr>

                            <div class="col-lg-6"  style="font-size: 14px">
                                <p id="purchase"> </p>
                            </div>
                            <div class="col-lg-6" style="font-size: 14px">
                                <input type="text" class="form-control" id="dCourseAmount"
                                       style="font-size: 14px" disabled>
                                <!--p id="dCourseAmount"></p-->
                            </div>


                            <div class="col-lg-6" style="font-size: 14px">
                                <p>Tax</p>
                            </div>
                            <div class="col-lg-6" style="font-size: 14px">
                                <input type="text" class="form-control" id="dTaxAmount"
                                       style="font-size: 14px" disabled>
                                <!--p id="dTaxAmount"></p-->
                            </div>

                            <hr>

                            
                            <div id="hone" class="col-lg-6" style="font-weight: 600">
                                <p>Paying<font color="red">* </font></p>
                            </div>
                            <div id="htwo" class="col-lg-6" style="font-weight: 600">
                                <input type="text" class="form-control" id="payingAmount"
                                       style="font-size: 14px" onkeyup="calcTaxAmount();">
                                <!--select class="form-control" id="payingAmount" style="font-size: 14px" onchange="calcTaxAmount();">
                                    <option value="">-Select Payment-</option>
                                </select-->
                                <!--p id="dTotalAmount"></p-->
                            </div>

                            <hr>

                            <div class="col-lg-6">

                                <input type="text" class="form-control" id="vcoupon"
                                       placeholder="Coupon Code" style="font-size: 14px">
                            </div>
                            <div class="col-lg-6">
                                <button type="button" class="btn pry-btn" onclick="validateCoupon();">APPLY</button>
                            </div>

                            <div class="col-lg-8">
                                <label class="form-label">Total Amount (CAD)</label>
                                <input type="text" class="form-control" id="dTotalAmount"
                                       style="font-size: 14px" disabled>
                            </div>

                            <hr class="mt-3">
                        </div>



                        <div class="mb-2 pt-4">
                            <h5>Card Details</h5>
                        </div>

                        <div class="mb-4 pr-5 pt-3 row">
                            <div class="col-lg-4">
                                <label class="form-label">Card Number</label>
                                <input type="text" class="form-control"
                                       placeholder="" id="cardNumber">
                            </div>
                            <div class="col-lg-2">
                                <label class="form-label">Expiry Month</label>
                                <input type="number" class="form-control"
                                       placeholder="" id="expMonth">
                            </div>
                            <div class="col-lg-2">
                                <label class="form-label">Expiry Year</label>
                                <input type="number" class="form-control"
                                       placeholder="" id="expYear">
                            </div>
                            <div class="col-lg-4">
                                <label class="form-label">CVV</label>
                                <input type="text" class="form-control"
                                       placeholder="" id="cvv">
                            </div>
                        </div>
                        <button type="button" class="btn mt-4 float-end pry-btn mr-5" onclick="completeOnline();">PLACE ORDER</button>
                    </form>

                    <form id="withoutPay" class=" mt-5 pt-5">
                        <div class="mb-4">
                            <h5>Billing Details</h5>
                        </div>
                        <div class="mb-4 row pr-5">
                            <div class="col-lg-6">
                                <label class="form-label">First Name<font color="red">*</font></label>
                                <input type="text" class="form-control" id="fname"
                                       placeholder="">
                            </div>
                            <div class="col-lg-6">
                                <label class="form-label">Last Name<font color="red">*</font></label>
                                <input type="text" class="form-control" id="lname"
                                       placeholder="">
                            </div>
                        </div>
                        <div class="mb-4 row pr-5">
                            <div class="col-lg-12">
                                <label class="form-label">Email Address<font color="red">*</font></label>
                                <input type="text" class="form-control" id="email"
                                       placeholder="" disabled>
                            </div>
                            <div class="col-lg-6">
                                <label class="form-label">Phone Number<font color="red">*</font></label>
                                <input type="text" class="form-control" id="pno"
                                       placeholder="">
                            </div>
                            <div class="col-lg-6">
                                <label class="form-label">Country / Region <font color="red">*</font></label>
                                <select class="form-control" id="country" onchange="changeCountry()">

                                </select>
                            </div>

                        </div>
                        <div class="mb-4 row pr-5">
                            <div class="col-lg-6">
                                <label class="form-label">Full street address <font color="red">*</font></label>
                                <input class="form-control" placeholder="Full street address" id="addr" onkeyup="pressKey(event);" type="text" pattern="[A-Za-z0-9, ]+" >
                            </div>
                            <div class="col-lg-6">
                                <label class="form-label">Apartment, Suite, Unit </label>
                                <input class="form-control" placeholder="Apartment, Suite, Unit (optional)" id="apartment" onkeyup="pressKey(event);" type="text">
                            </div>

                        </div>
                        <div class="mb-4 row pr-5">
                            <div class="col-lg-6">
                                <label class="form-label">Town / city <font color="red">*</font></label>
                                <input class="form-control" placeholder="Town / city" id="town" onkeyup="pressKey(event);" type="text" pattern="[A-Za-z- ]+" >
                            </div>
                            <div id="hidprovince" class="col-lg-6">
                                <label class="form-label">Province <font color="red">*</font></label>
                                <select class="form-control" id="province1" onchange="changeProvince()">
                                    <option value="" selected>-Select Province-</option>

                                </select>
                            </div>
                            <div id="hidstate" class="col-lg-6">
                                <label class="form-label">State <font color="red">*</font></label>
                                <input class="form-control" placeholder="State" id="province" onkeyup="pressKey(event);" type="text" pattern="[A-Za-z- ]+" >
                            </div>

                        </div>
                        <div class="mb-4 pt-3">
                            <h5>User Login Details</h5>
                        </div>

                        <div class="mb-4 pr-5 row">
                            <div class="col-lg-6">
                                <label class="form-label">Display Name</label>
                                <input type="text" class="form-control" id="dname"
                                       placeholder="">
                            </div>
                            <div class="col-lg-6">
                                <label class="form-label">Username<font color="red">*</font></label>
                                <input type="text" class="form-control" id="username"
                                       placeholder="">
                            </div>
                        </div>
                        <div class="mb-4 pr-5 row">
                            <div class="col-lg-6">
                                <label class="form-label">Password<font color="red">*</font></label>
                                <input type="password" class="form-control" id="password"
                                       placeholder="">
                            </div>
                            <div class="col-lg-6">
                                <label class="form-label">Confirm Password</label>
                                <input type="password" class="form-control" id="cpassword"
                                       placeholder="">
                            </div>
                        </div>
                        <button type="button" class="btn mt-4 float-end pry-btn mr-5" onclick="completeOffline();">SIGN UP</button>
                    </form>
            </div>
        </div>
    </div>
</div>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
    integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
    crossorigin="anonymous"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script src="countries.js"></script>
<script src="provinces.js"></script>

<script>
    //var url = "http://localhost:8080";
    //var wordpressUrl = "http://localhost:8099";
    var url = "https://proinsight-reconservice.herokuapp.com";
    var wordpressUrl = "https://proinsight-lmsservice.herokuapp.com";
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const id = urlParams.get('id');
    const course = urlParams.get('course');
    var tax = 0;
    var courseAmount = 0;
    var minCourseAmount = 0;
    var discount = 0;
    var installmentAmount = 0;

    //ON-READY FUNCTION
    (function() {
        if(course == "PM"){
            document.getElementById("purchase").innerHTML = "Project Management";
        }else if(course == "BA"){
            document.getElementById("purchase").innerHTML = "Business Analysis";
        }else{
            document.getElementById("purchase").innerHTML = "Manage Financials";
        }
        //Calling the countries list
        document.getElementById("hidstate").style.display = "none";
        document.getElementById("hone").style.display = "none";
        document.getElementById("htwo").style.display = "none";
        let dateDropdown = document.getElementById("country"); 
        var i = 0;
        while (i < countries.length) {      
            let dateOption = document.createElement('option');          
            dateOption.text = countries[i].name;      
            dateOption.value = countries[i].name;        
            dateDropdown.appendChild(dateOption);      
            i++;    
        }
        document.getElementById("country").text = "Canada";
        document.getElementById("country").value = "Canada";
        let cprovinces = document.getElementById("province1"); 
        var j = 0;
        while (j < provinces.length) { 
            let dateOption1 = document.createElement('option');          
            dateOption1.text = provinces[j].name;      
            dateOption1.value = provinces[j].name;        
            cprovinces.appendChild(dateOption1);      
            j++;    
        }
        document.getElementById("whidstate").style.display = "none";
        let wdateDropdown = document.getElementById("wcountry"); 
        var x = 0;
        while (x < countries.length) {      
            let dateOption = document.createElement('option');          
            dateOption.text = countries[x].name;      
            dateOption.value = countries[x].name;        
            wdateDropdown.appendChild(dateOption);      
            x++;    
        }
        document.getElementById("wcountry").text = "Canada";
        document.getElementById("wcountry").value = "Canada";
        let wcprovinces = document.getElementById("wprovince1"); 
        var y = 0;
        while (y < provinces.length) { 
            let dateOption1 = document.createElement('option');          
            dateOption1.text = provinces[y].name;      
            dateOption1.value = provinces[y].name;        
            wcprovinces.appendChild(dateOption1);      
            y++;    
        }
        console.log("id "+id);
        if(course != null){
            $.ajax({
    	        type: "GET",
       	        beforeSend: function(request) {
       	            request.setRequestHeader("Access-Control-Allow-Headers", "X-Requested-With, content-type");
       	        },
                url: url + "/tax/get",
                contentType: "application/json",
                dataType: 'json',
                success: function(result){
                    if(result.value != null){
                        console.log("Get Tax1"+result.value);
                        tax = result.value;
                        $.ajax({
    	                    type: "GET",
       	                    beforeSend: function(request) {
       	                        request.setRequestHeader("Access-Control-Allow-Headers", "X-Requested-With, content-type");
       	                    },
                            url: url + "/courseprice/get/" + course,
                            contentType: "application/json",
                            dataType: 'json',
                            success: function(result){
                                if(result.price != null){
                                    console.log("Get Course Price1"+result.price);
                                    courseAmount = result.price;
                                    minCourseAmount = result.minimumPayment;
                                    var taxAmount = ((tax * courseAmount) / 100);
                                    var totalAmount = courseAmount + taxAmount; 
                                    document.getElementById("totalFee").innerHTML = "Training Fee is $" + courseAmount + "CAD";
                                    document.getElementById("dCourseAmount").value = courseAmount;
                                    document.getElementById("dCourseAmount").text = courseAmount;
                                    document.getElementById("dTaxAmount").value = taxAmount;
                                    document.getElementById("dTaxAmount").text = taxAmount;
                                    document.getElementById("dTotalAmount").value = totalAmount;
                                    document.getElementById("dTotalAmount").text = totalAmount;
                                    document.getElementById("payingAmount").value = courseAmount;
                                    document.getElementById("payingAmount").text = courseAmount;
                                    //document.getElementById("minInfo").innerHTML = "Minimum Initial Deposit is $" + minCourseAmount + "CAD (tax excl.)";
                                    //document.getElementById("payingAmount").text = totalAmount;
                                    //document.getElementById("payingAmount").value = totalAmount;
                                }
                            },
                            error: function(result){
                                console.log(result.responseText);
                            }
                        })
                    }
                },
                error: function(result){
                    console.log(result.responseText);
                }
            })
        
        
        }
        //Calling the User Details API
        $.ajax({
            type: "GET",
            beforeSend: function(request) {
                request.setRequestHeader("Access-Control-Allow-Headers", "X-Requested-With, content-type");
                request.setRequestHeader("Access-Control-Allow-Origin", "*");
            },
            url: url + "/users/getCand/" + id,
            contentType: "application/json",
            dataType: 'json',
            success: function(result){
                console.log("Here "+result.paymentType);
                if(result.paymentType == 1){
                    document.getElementById("withoutPay").style.display = "block";
                    document.getElementById("withPay").style.display = "none";
                    document.getElementById("fname").value = result.fname;
                    document.getElementById("lname").value = result.lname;
                    document.getElementById("email").value = result.email;
                    document.getElementById("fname").text = result.fname;
                    document.getElementById("lname").text = result.lname;
                    document.getElementById("email").text = result.email;
                }else{
                    document.getElementById("withoutPay").style.display = "none";
                    document.getElementById("withPay").style.display = "block";
                    document.getElementById("wfname").value = result.fname;
                    document.getElementById("wlname").value = result.lname;
                    document.getElementById("wemail").value = result.email;
                    document.getElementById("wfname").text = result.fname;
                    document.getElementById("wlname").text = result.lname;
                    document.getElementById("wemail").text = result.email;
                }
            },
            error: function(result){
                console.log("Here "+result.statusText);
            }
        })

        //Calling the course prices
        $.ajax({
            type: "GET",
            beforeSend: function(request) {
                request.setRequestHeader("Access-Control-Allow-Headers", "X-Requested-With, content-type");
                request.setRequestHeader("Access-Control-Allow-Origin", "*");
            },
            url: url + "/courseinstallment/getForCourse/" + course,
            contentType: "application/json",
            dataType: 'json',
            success: function(result){
                console.log("Hi"+result.length);
                installmentAmount = result[0].amount;
                //Preparing the Select List
                /*var dropDown = document.getElementById("payingAmount");
                for(var i = 0; i < result.length; i++) {
                    var el = document.createElement("option");
                    el.innerHTML = result[i].amount;
                    el.value = result[i].amount;
                    dropDown.appendChild(el);
                }*/
            },
            error: function(result){
                console.log("Error"+result.statusText);
            }
        })
    })();

    //Method to complete offline registration
    function completeOffline(){
        var pass = document.getElementById("password").value;
        var cpass = document.getElementById("cpassword").value;
        if(pass != cpass){
            swal({
                title: "Password Mismatch",
                text: "Password Is Not Consistent!",
                icon: "error",
            });
        }else {
            var ouser = {
                displayName : document.getElementById("dname").value,
                userLogin : document.getElementById("username").value,
                userEmail : document.getElementById("email").value,
                userNicename : document.getElementById("username").value,
                userPass : pass
            }
            var ousermetas = [
                {
                    metaKey : "country",
                    metaValue : document.getElementById("country").value
                },
                {
                    metaKey : "address",
                    metaValue : document.getElementById("addr").value
                },
                {
                    metaKey : "apartment",
                    metaValue : document.getElementById("apartment").value
                },
                {
                    metaKey : "town",
                    metaValue : document.getElementById("town").value
                },
                {
                    metaKey : "province",
                    metaValue : document.getElementById("province").value
                },
                {
                    metaKey : "phoneno",
                    metaValue : document.getElementById("pno").value
                }
            ]
            var regUser = JSON.stringify({
                    'user' : ouser,
                    'usermetas' : ousermetas
                });
            $.ajax({
    	        type: "POST",
       	        beforeSend: function(request) {
       	            request.setRequestHeader("Access-Control-Allow-Headers", "X-Requested-With, content-type");
       	        },
                url: wordpressUrl + "/wpusers/add",
                contentType: "application/json",
                dataType: 'json',
                data: regUser,
                success: function(result){
                    swal({
                        title: result['status'],
                        text: result['message'],
                        icon: "success",
                    })
                    .then(() => {
                        completeRegistrationHelper(1);
                    });
                },
                error: function(result){
                    console.log(result.responseText);
                    var json = $.parseJSON(result.responseText);
                    swal({
                        title: json.status,
                        text: json.message,
                        icon: "error",
                    });
                }
            })
        }
    }

    //Method to help complete registation reconciliation
    function completeRegistrationHelper(myPayType){
        var fname = "";
        var lname = "";
        var email = "";
        var prog = "";
        var addr = "";
        var town = "";
        var state = "";
        var country = "";
        var pno = ""
        if(myPayType == 1){
            fname = document.getElementById("fname").value;
            lname = document.getElementById("lname").value;
            email = document.getElementById("email").value;
            var ad1 = document.getElementById("addr").value;
            var ad2 = document.getElementById("apartment").value;
            addr = ad1 + " " + ad2;
            town = document.getElementById("town").value;
            state = document.getElementById("province").value;
            country = document.getElementById("country").value;
            pno = document.getElementById("pno").value;
        }else{
            fname = document.getElementById("wfname").value;
            lname = document.getElementById("wlname").value;
            email = document.getElementById("wemail").value;
            var ad1 = document.getElementById("waddr").value;
            var ad2 = document.getElementById("wapartment").value;
            addr = ad1 + " " + ad2;
            town = document.getElementById("wtown").value;
            state = document.getElementById("wprovince").value;
            country = document.getElementById("wcountry").value;
            pno = document.getElementById("wpno").value;
            if(course == "PM"){
                prog = "Project Management Comprehensive";
            }else if(course == "BA"){
                prog = "Business Analysis Comprehensive";
            }else{
                prog = "Managing Project Financials";
            }
        }
        $.ajax({
    	    type: "POST",
       	    beforeSend: function(request) {
       	        request.setRequestHeader("Access-Control-Allow-Headers", "X-Requested-With, content-type");
       	    },
            url: url + "/users/completeCandidate",
            contentType: "application/json",
            dataType: 'json',
            data: JSON.stringify({
                id : id,
                fname : fname,
                lname : lname,
                email : email,
                paymentType : myPayType,
                program : prog,
                address : addr,
                town : town,
                state : state,
                country : country,
                pno : pno
            }),
            success: function(result){
                console.log(result.statusText);
                location.reload();
            },
            error: function(result){
                console.log(result.responseText);
            }
        })
    }

    //Method to fetch tax rate
    function taxRate(){
        $.ajax({
    	    type: "GET",
       	    beforeSend: function(request) {
       	        request.setRequestHeader("Access-Control-Allow-Headers", "X-Requested-With, content-type");
       	    },
            url: url + "/tax/get",
            contentType: "application/json",
            dataType: 'json',
            success: function(result){
                if(result.value != null){
                    console.log("Get Tax"+result.value);
                    tax = result.value;
                }
            },
            error: function(result){
                console.log(result.responseText);
            }
        })
    }

    //Method to get course amount
    function coursePrice(){
        $.ajax({
    	    type: "GET",
       	    beforeSend: function(request) {
       	        request.setRequestHeader("Access-Control-Allow-Headers", "X-Requested-With, content-type");
       	    },
            url: url + "/courseprice/get/" + course,
            contentType: "application/json",
            dataType: 'json',
            success: function(result){
                if(result.price != null){
                    console.log("Get Course Price"+result.price);
                    courseAmount = result.price;
                    minCourseAmount = result.minimumPayment;
                    //document.getElementById("minInfo").innerHTML = "Minimum Initial Deposit is $" + minCourseAmount + "CAD (tax excl.)";
                }
            },
            error: function(result){
                console.log(result.responseText);
            }
        })
    }

    //Method to validate coupon
    function validateCoupon(){
        var vcoupon = document.getElementById("vcoupon").value;
        //var payAmount = document.getElementById("payingAmount").value;
        console.log("amount "+courseAmount);
        $.ajax({
    	    type: "GET",
       	    beforeSend: function(request) {
       	        request.setRequestHeader("Access-Control-Allow-Headers", "X-Requested-With, content-type");
       	    },
            url: url + "/bonus/validate/" + vcoupon + "/" + courseAmount,
            contentType: "application/json",
            dataType: 'json',
            success: function(result){
                swal({
                    title: result['status'],
                    text: result['message'],
                    icon: "success",
                })
                .then(() => {
                    discount = courseAmount - result['data'];
                    courseAmount = result['data'];
                    var taxAmount = ((tax * courseAmount) / 100);
                    var totalAmount = courseAmount + taxAmount; 
                    document.getElementById("totalFee").innerHTML = "Training Fee is $" + courseAmount + "CAD";
                    document.getElementById("dCourseAmount").value = courseAmount;
                    document.getElementById("dCourseAmount").text = courseAmount;
                    document.getElementById("dTaxAmount").value = taxAmount;
                    document.getElementById("dTaxAmount").text = taxAmount;
                    document.getElementById("dTotalAmount").value = totalAmount;
                    document.getElementById("dTotalAmount").text = totalAmount;
                    //document.getElementById("payingAmount").text = totalAmount;
                    //document.getElementById("payingAmount").value = totalAmount;
                });
            },
            error: function(result){
                console.log(result.responseText);
                var json = $.parseJSON(result.responseText);
                swal({
                    title: json.status,
                    text: json.message,
                    icon: "error",
                });
            }
        })
    }

    //On Change Country
    function changeCountry(){
        var e = document.getElementById("country");
        var chosenCountry = e.value;
        if(chosenCountry == "Canada"){
            document.getElementById("hidprovince").style.display = "block";
            document.getElementById("hidstate").style.display = "none";
        }else {
            document.getElementById("hidprovince").style.display = "none";
            document.getElementById("hidstate").style.display = "block";
        }
    }
    function changeCountry1(){
        var e = document.getElementById("wcountry");
        var chosenCountry = e.value;
        if(chosenCountry == "Canada"){
            document.getElementById("whidprovince").style.display = "block";
            document.getElementById("whidstate").style.display = "none";
        }else{
            document.getElementById("whidprovince").style.display = "none";
            document.getElementById("whidstate").style.display = "block";
        }
    }

    //On Select Canadian Province
    function changeProvince(){
        var e = document.getElementById("province1");
        var chosenProvince = e.value;
        document.getElementById("province").value = chosenProvince;
        document.getElementById("province").text = chosenProvince;
    }
    function changeProvince1(){
        var e = document.getElementById("wprovince1");
        var chosenProvince = e.value;
        document.getElementById("wprovince").value = chosenProvince;
        document.getElementById("wprovince").text = chosenProvince;
    }

    //Method to complete online registration
    function completeOnline(){
        var pass = document.getElementById("wpassword").value;
        var cpass = document.getElementById("wcpassword").value;
        var pAmount = document.getElementById("payingAmount").value;
        if(pass != cpass){
            swal({
                title: "Password Mismatch",
                text: "Password Is Not Consistent!",
                icon: "error",
            });
        }else if((installmentAmount <= courseAmount) && (pAmount < minCourseAmount || pAmount < installmentAmount)){
            swal({
                title: "Amount Declined",
                text: "Amount To Pay Is Below Minimum Amount!",
                icon: "error",
            });
        }else {
            var ouser = {
                displayName : document.getElementById("wdname").value,
                userLogin : document.getElementById("wusername").value,
                userEmail : document.getElementById("wemail").value,
                userNicename : document.getElementById("wusername").value,
                userPass : pass
            }
            var ousermetas = [
                {
                    metaKey : "country",
                    metaValue : document.getElementById("wcountry").value
                },
                {
                    metaKey : "address",
                    metaValue : document.getElementById("waddr").value
                },
                {
                    metaKey : "apartment",
                    metaValue : document.getElementById("wapartment").value
                },
                {
                    metaKey : "town",
                    metaValue : document.getElementById("wtown").value
                },
                {
                    metaKey : "province",
                    metaValue : document.getElementById("wprovince").value
                },
                {
                    metaKey : "phoneno",
                    metaValue : document.getElementById("wpno").value
                }
            ]
            var currency = "cad";
            var description = "Online Course Payment To Olade";
            var chargeDTO = {
                amount : pAmount,
                currency : currency,
                description : description
            }
            var paymentTokenDTO = {
                cardNumber : document.getElementById("cardNumber").value,
                cvc : document.getElementById("cvv").value,
                expMonth : document.getElementById("expMonth").value,
                expYear : document.getElementById("expYear").value
            }
            var regUser = JSON.stringify({
                    'user' : ouser,
                    'usermetas' : ousermetas,
                    'paymentDTO' : paymentTokenDTO,
                    'chargeDTO' : chargeDTO
                });
            $.ajax({
    	        type: "POST",
       	        beforeSend: function(request) {
       	            request.setRequestHeader("Access-Control-Allow-Headers", "X-Requested-With, content-type");
       	        },
                url: wordpressUrl + "/wpusers/payandreg",
                contentType: "application/json",
                dataType: 'json',
                data: regUser,
                success: function(result){
                    swal({
                        title: result['status'],
                        text: result['message'],
                        icon: "success",
                    })
                    .then(() => {
                        completeRegistrationHelper(2);
                        addPayment();
                    });
                },
                error: function(result){
                    console.log(result.responseText);
                    var json = $.parseJSON(result.responseText);
                    swal({
                        title: json.status,
                        text: json.message,
                        icon: "error",
                    });
                }
            })
        }
    }

    //Method to add payment record 
    function addPayment(){
        //var taxAmount = ((tax * courseAmount) / 100);
        //var totalAmount = courseAmount + taxAmount; 
        //console.log("amount "+courseAmount);
        var pAmount = document.getElementById("payingAmount").value;
        $.ajax({
    	    type: "POST",
       	    beforeSend: function(request) {
       	        request.setRequestHeader("Access-Control-Allow-Headers", "X-Requested-With, content-type");
       	    },
            url: url + "/payments/add",
            contentType: "application/json",
            dataType: 'json',
            data: JSON.stringify({
                courseName : course,
                amount : courseAmount,
                taxAmount : document.getElementById("dTaxAmount").value,
                totalAmount : document.getElementById("dTotalAmount").value,
                paidAmount : pAmount,
                discount : discount,
                candidateEmail : document.getElementById("wemail").value
            }),
            success: function(result){
                console.log(result.statusText);
                location.reload();
            },
            error: function(result){
                console.log(result.responseText);
            }
        })
    }

    //Method to calculate tax amount from paying amount
    function calcTaxAmount(){
        var pAmount = document.getElementById("payingAmount").value;
        var payAmount = pAmount * 1;
        var taxAmount = ((tax * payAmount) / 100);
        var totalAmount = payAmount + taxAmount; 
        document.getElementById("dTaxAmount").value = taxAmount;
        document.getElementById("dTaxAmount").text = taxAmount;
        document.getElementById("dTotalAmount").value = totalAmount;
        document.getElementById("dTotalAmount").text = totalAmount;
    }

    function showAmount(){
        var e = document.getElementById("paymentType");
        var pType = e.value;
        if(pType == 1){
            document.getElementById("payingAmount").value = courseAmount;
            document.getElementById("payingAmount").text = courseAmount;
        }else{
            document.getElementById("payingAmount").value = installmentAmount;
            document.getElementById("payingAmount").text = installmentAmount;
            //document.getElementById("minInfo").innerHTML = "Choosing Installmental Payments option can attract extra charges";
        }

        calcTaxAmount();
    }
</script>


</body>
</html>
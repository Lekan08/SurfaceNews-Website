<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="apple-touch-icon" sizes="76x76" href="assets/images/olade-logo-blue.png">
    <link rel="icon" type="image/png" href="assets/images/olade-logo-blue.png">
    <!--    font-awesome-->
    <link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">

    <link rel="stylesheet" href="assets/css/main.css">
    <link href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300;0,400;0,500;0,600;0,700;0,900;1,300;1,600;1,800&display=swap" rel="stylesheet">
    <title>Candidate Enrollment</title>
</head>
<body>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-4">
            <div class="login-bg text-white">
                <div class="pt-lg-5">
                    <p class="">Find Bright, Diverse And
                        <br>
                        Innovative Tech Talent
                    </p>
                </div>
            </div>

        </div>
        <div class="col-md-8 m-auto">
            <div class="container p-5">
                <div class="float-end">
                    <a href="" id="logo-container"><img src="assets/images/olade-logo-blue.png" width="70" alt=""></a>
                </div>
            </div>

            <div class="login-form ">
                    <h1>Student Enrollment</h1>
                    <form id="withPay" class=" mt-4">
                        <div class="mb-4">
                            <h5>Personal Details</h5>
                        </div>
                        <div class="mb-4 row pr-5">
                            <div class="col-lg-6">
                                <label class="form-label">First Name<font color="red">*</font></label>
                                <input type="text" class="form-control" id="wfname"
                                       placeholder="">
                            </div>
                            <div class="col-lg-6">
                                <label class="form-label">Last Name<font color="red">*</font></label>
                                <input type="text" class="form-control" id="wlname"
                                       placeholder="">
                            </div>
                        </div>
                        <div class="mb-4 row pr-5">
                            <div class="col-lg-6">
                                <label class="form-label">Nick Name</label>
                                <input type="text" class="form-control" id="wnname"
                                       placeholder="">
                            </div>
                            <div class="col-lg-6">
                                <label class="form-label">Email Address<font color="red">*</font></label>
                                <input type="text" class="form-control" id="wemail"
                                       placeholder="">
                            </div>

                        </div>
                        <div class="mb-4 pt-3">
                            <h5>User Login Details</h5>
                        </div>

                        <div class="mb-4 pr-5 row">
                            <div class="col-lg-6">
                                <label class="form-label">Display Name</label>
                                <input type="text" class="form-control" id="wdname"
                                       placeholder="">
                            </div>
                            <div class="col-lg-6">
                                <label class="form-label">Username<font color="red">*</font></label>
                                <input type="text" class="form-control" id="wusername"
                                       placeholder="">
                            </div>
                        </div>
                        <div class="mb-4 pr-5 row">
                            <div class="col-lg-6">
                                <label class="form-label">Password<font color="red">*</font></label>
                                <input type="password" class="form-control" id="wpassword"
                                       placeholder="">
                            </div>
                            <div class="col-lg-6">
                                <label class="form-label">Confirm Password<font color="red">*</font></label>
                                <input type="password" class="form-control" id="wcpassword"
                                       placeholder="">
                            </div>
                        </div>
                        <div class="mb-2 pt-4">
                            <h5>Card Details</h5><br>
                            <h6 id="totalFee"></h6>
                        </div>

                        <div class="row" style="width: 75%">
                            <div class="col-lg-6" style="font-weight: 600">
                               <p> Product</p>
                            </div>
                            <div class="col-lg-6" style="font-weight: 600">
                                <p>Subtotal</p>
                            </div>

                            <hr>

                            <div class="col-lg-6"  style="font-size: 14px">
                                <p> Project management</p>
                            </div>
                            <div class="col-lg-6" style="font-size: 14px">
                                <p>$1,130.00 (incl. tax)</p>
                            </div>


                            <div class="col-lg-6" style="font-size: 14px">
                                <p>Subtotal</p>
                            </div>
                            <div class="col-lg-6" style="font-size: 14px">
                                <p>$1,130.00 (incl. tax)</p>
                            </div>

                            <hr>

                            <div class="col-lg-6" style=";font-weight: 600">
                                <p>Total</p>
                            </div>
                            <div class="col-lg-6" style=";font-weight: 600">
                                <p>$1,130.00 (includes $130.00 HST)</p>
                            </div>

                            <hr>

                            <div class="col-lg-6">

                                <input type="text" class="form-control" id="vcoupon"
                                       placeholder="Coupon Code" style="font-size: 14px">
                            </div>
                            <div class="col-lg-6">
                                <button type="button" class="btn pry-btn" onclick="validateCoupon();">APPLY</button>
                            </div>

                            <hr class="mt-3">
                        </div>



                        <div class="mb-4 pr-5 pt-3 row">
                            <div class="col-lg-4">
                                <label class="form-label">Card Number</label>
                                <input type="text" class="form-control"
                                       placeholder="">
                            </div>
                            <div class="col-lg-4">
                                <label class="form-label">Expiry Date</label>
                                <input type="text" class="form-control"
                                       placeholder="">
                            </div>
                            <div class="col-lg-4">
                                <label class="form-label">CVV</label>
                                <input type="text" class="form-control"
                                       placeholder="">
                            </div>
                        </div>
                        <button type="button" class="btn mt-4 float-end pry-btn mr-5" data-toggle="modal" data-target="#paymentDetails">PLACE ORDER</button>
                    </form>

                    <form id="withoutPay" class=" mt-5 pt-5">
                        <div class="mb-4">
                            <h5>General Details</h5>
                        </div>
                        <div class="mb-4 row pr-5">
                            <div class="col-lg-6">
                                <label class="form-label">First Name<font color="red">*</font></label>
                                <input type="text" class="form-control" id="fname"
                                       placeholder="">
                            </div>
                            <div class="col-lg-6">
                                <label class="form-label">Last Name<font color="red">*</font></label>
                                <input type="text" class="form-control" id="lname"
                                       placeholder="">
                            </div>
                        </div>
                        <div class="mb-4 row pr-5">
                            <div class="col-lg-6">
                                <label class="form-label">Nick Name</label>
                                <input type="text" class="form-control" id="nname"
                                       placeholder="">
                            </div>
                            <div class="col-lg-6">
                                <label class="form-label">Email Address<font color="red">*</font></label>
                                <input type="text" class="form-control" id="email"
                                       placeholder="">
                            </div>

                        </div>
                        <div class="mb-4 pt-3">
                            <h5>User Login Details</h5>
                        </div>

                        <div class="mb-4 pr-5 row">
                            <div class="col-lg-6">
                                <label class="form-label">Display Name</label>
                                <input type="text" class="form-control" id="dname"
                                       placeholder="">
                            </div>
                            <div class="col-lg-6">
                                <label class="form-label">Username<font color="red">*</font></label>
                                <input type="text" class="form-control" id="username"
                                       placeholder="">
                            </div>
                        </div>
                        <div class="mb-4 pr-5 row">
                            <div class="col-lg-6">
                                <label class="form-label">Password<font color="red">*</font></label>
                                <input type="password" class="form-control" id="password"
                                       placeholder="">
                            </div>
                            <div class="col-lg-6">
                                <label class="form-label">Confirm Password</label>
                                <input type="password" class="form-control" id="cpassword"
                                       placeholder="">
                            </div>
                        </div>
                        <button type="button" class="btn mt-4 float-end pry-btn mr-5" onclick="completeOffline();">SIGN UP</button>
                    </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="paymentDetails" tabindex="-1" aria-labelledby="paymentDetailsLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Course Payment Breakdown</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group row">
                    <div class="col-xs-10">
                        <label>Course Amount</label>&nbsp;<label id="dCourseAmount"></label>
                    </div>
                </div>

                <div class="form-group row">
                    <div class="col-xs-10">
                        <label>Tax Amount</label>&nbsp;<label id="dTaxAmount"></label>
                    </div>
                </div>

                <div class="form-group row">
                    <div class="col-xs-10">
                        <label>Total Amount</label>&nbsp; <label id="dTotalAmount"></label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="pay();">Pay</button>
            </div>
        </div>
    </div>
  </div>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
    integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
    crossorigin="anonymous"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

<script>
    var url = "http://localhost:8080";
    //var wordpressUrl = "http://localhost:8099";
    //var url = "https://proinsight-reconservice.herokuapp.com";
    var wordpressUrl = "https://proinsight-lmsservice.herokuapp.com";
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const id = urlParams.get('id');
    const course = urlParams.get('course');
    var tax = 0;
    var courseAmount = 0;

    //ON-READY FUNCTION
    (function() {
        console.log("id "+id);
        if(course != null){
            $.ajax({
    	        type: "GET",
       	        beforeSend: function(request) {
       	            request.setRequestHeader("Access-Control-Allow-Headers", "X-Requested-With, content-type");
       	        },
                url: url + "/tax/get",
                contentType: "application/json",
                dataType: 'json',
                success: function(result){
                    if(result.value != null){
                        console.log("Get Tax1"+result.value);
                        tax = result.value;
                        $.ajax({
    	                    type: "GET",
       	                    beforeSend: function(request) {
       	                        request.setRequestHeader("Access-Control-Allow-Headers", "X-Requested-With, content-type");
       	                    },
                            url: url + "/courseprice/get/" + course,
                            contentType: "application/json",
                            dataType: 'json',
                            success: function(result){
                                if(result.price != null){
                                    console.log("Get Course Price1"+result.price);
                                    courseAmount = result.price;
                                    var taxAmount = ((tax * courseAmount) / 100);
                                    var totalAmount = courseAmount + taxAmount; 
                                    document.getElementById("totalFee").innerHTML = "Training Fee is $" + totalAmount + "CAD";
                                    document.getElementById("dCourseAmount").innerHTML = "$" + courseAmount + "CAD";
                                    document.getElementById("dTaxAmount").innerHTML = "$" + taxAmount + "CAD";
                                    document.getElementById("dTotalAmount").innerHTML = "$" + totalAmount + "CAD";
                                }
                            },
                            error: function(result){
                                console.log(result.responseText);
                            }
                        })
                    }
                },
                error: function(result){
                    console.log(result.responseText);
                }
            })
        
        
        }
        //Calling the User Details API
        $.ajax({
            type: "GET",
            beforeSend: function(request) {
                request.setRequestHeader("Access-Control-Allow-Headers", "X-Requested-With, content-type");
                request.setRequestHeader("Access-Control-Allow-Origin", "*");
            },
            url: url + "/users/getCand/" + id,
            contentType: "application/json",
            dataType: 'json',
            success: function(result){
                console.log("Here "+result.paymentType);
                if(result.paymentType == 1){
                    document.getElementById("withoutPay").style.display = "block";
                    document.getElementById("withPay").style.display = "none";
                    document.getElementById("fname").value = result.fname;
                    document.getElementById("lname").value = result.lname;
                    document.getElementById("email").value = result.email;
                    document.getElementById("fname").text = result.fname;
                    document.getElementById("lname").text = result.lname;
                    document.getElementById("email").text = result.email;
                }else{
                    document.getElementById("withoutPay").style.display = "none";
                    document.getElementById("withPay").style.display = "block";
                    document.getElementById("wfname").value = result.fname;
                    document.getElementById("wlname").value = result.lname;
                    document.getElementById("wemail").value = result.email;
                    document.getElementById("wfname").text = result.fname;
                    document.getElementById("wlname").text = result.lname;
                    document.getElementById("wemail").text = result.email;
                }
            },
            error: function(result){
                console.log("Here "+result.statusText);
            }
        })
    })();

    //Method to complete offline registration
    function completeOffline(){
        var pass = document.getElementById("password").value;
        var cpass = document.getElementById("cpassword").value;
        if(pass != cpass){
            swal({
                title: "Password Mismatch",
                text: "Password Is Not Consistent!",
                icon: "error",
            });
        }else {
            $.ajax({
    	        type: "POST",
       	        beforeSend: function(request) {
       	            request.setRequestHeader("Access-Control-Allow-Headers", "X-Requested-With, content-type");
       	        },
                url: wordpressUrl + "/wpusers/add",
                contentType: "application/json",
                dataType: 'json',
                data: JSON.stringify({
                    displayName : document.getElementById("dname").value,
                    userLogin : document.getElementById("username").value,
                    userEmail : document.getElementById("email").value,
                    //first_name : document.getElementById("fname").value,
                    //last_name : document.getElementById("lname").value,
                    userNicename : document.getElementById("nname").value,
                    userPass : pass/*,
                    meta: JSON.stringify({
                        nickname: document.getElementById("nname").value,
                        first_name : document.getElementById("fname").value,
                        last_name : document.getElementById("lname").value,
                        full_name: document.getElementById("fname").value + " " + document.getElementById("lname").value
                    })*/
                }),
                success: function(result){
                    swal({
                        title: result['status'],
                        text: result['message'],
                        icon: "success",
                    })
                    .then(() => {
                        completeOfflineHelper();
                    });
                },
                error: function(result){
                    console.log(result.responseText);
                    var json = $.parseJSON(result.responseText);
                    swal({
                        title: json.status,
                        text: json.message,
                        icon: "error",
                    });
                }
            })
        }
    }

    //Method to help complete offline registation reconciliation
    function completeOfflineHelper(){
        $.ajax({
    	    type: "POST",
       	    beforeSend: function(request) {
       	        request.setRequestHeader("Access-Control-Allow-Headers", "X-Requested-With, content-type");
       	    },
            url: url + "/users/completeOfflineCandidate",
            contentType: "application/json",
            dataType: 'json',
            data: JSON.stringify({
                id : id,
                fname : document.getElementById("fname").value,
                lname : document.getElementById("lname").value,
                email : document.getElementById("email").value,
                paymentType : 1
            }),
            success: function(result){
                console.log(result.statusText);
                location.reload();
            },
            error: function(result){
                console.log(result.responseText);
            }
        })
    }

    //Method to fetch tax rate
    function taxRate(){
        $.ajax({
    	    type: "GET",
       	    beforeSend: function(request) {
       	        request.setRequestHeader("Access-Control-Allow-Headers", "X-Requested-With, content-type");
       	    },
            url: url + "/tax/get",
            contentType: "application/json",
            dataType: 'json',
            success: function(result){
                if(result.value != null){
                    console.log("Get Tax"+result.value);
                    tax = result.value;
                }
            },
            error: function(result){
                console.log(result.responseText);
            }
        })
    }

    //Method to get course amount
    function coursePrice(){
        $.ajax({
    	    type: "GET",
       	    beforeSend: function(request) {
       	        request.setRequestHeader("Access-Control-Allow-Headers", "X-Requested-With, content-type");
       	    },
            url: url + "/courseprice/get/" + course,
            contentType: "application/json",
            dataType: 'json',
            success: function(result){
                if(result.price != null){
                    console.log("Get Course Price"+result.price);
                    courseAmount = result.price;
                }
            },
            error: function(result){
                console.log(result.responseText);
            }
        })
    }

    //Method to validate coupon
    function validateCoupon(){
        var vcoupon = document.getElementById("vcoupon").value;
        console.log("amount "+courseAmount);
        $.ajax({
    	    type: "GET",
       	    beforeSend: function(request) {
       	        request.setRequestHeader("Access-Control-Allow-Headers", "X-Requested-With, content-type");
       	    },
            url: url + "/bonus/validate/" + vcoupon + "/" + courseAmount,
            contentType: "application/json",
            dataType: 'json',
            success: function(result){
                swal({
                    title: result['status'],
                    text: result['message'],
                    icon: "success",
                })
                .then(() => {
                    courseAmount = result['data'];
                    var taxAmount = ((tax * courseAmount) / 100);
                    var totalAmount = courseAmount + taxAmount; 
                    document.getElementById("totalFee").innerHTML = "Training Fee is $" + totalAmount + "CAD";
                    document.getElementById("dCourseAmount").innerHTML = "$" + courseAmount + "CAD";
                    document.getElementById("dTaxAmount").innerHTML = "$" + taxAmount + "CAD";
                    document.getElementById("dTotalAmount").innerHTML = "$" + totalAmount + "CAD";
                });
            },
            error: function(result){
                console.log(result.responseText);
                var json = $.parseJSON(result.responseText);
                swal({
                    title: json.status,
                    text: json.message,
                    icon: "error",
                });
            }
        })
    }
</script>


</body>
</html>